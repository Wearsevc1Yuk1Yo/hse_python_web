<!DOCTYPE html>
<html>
<head>
    <title>–ú–æ–π –ë–ª–æ–≥</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>–ú–æ–π –ë–ª–æ–≥</h1>
            
            <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="user-panel">
                {% if current_user %}
                    <div class="user-info">
                        <span>–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <strong>{{ current_user.login }}</strong></span>
                        <div class="user-actions">
                            <a href="/logout" class="btn-secondary">–í—ã–π—Ç–∏</a>
                            
                            <!-- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
                            {% if all_users|length > 1 %}
                            <div class="user-switcher">
                                <span>–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞:</span>
                                <select onchange="switchUser(this.value)">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
                                    {% for user in all_users %}
                                        {% if user.id != current_user.id %}
                                        <option value="{{ user.id }}">{{ user.login }} ({{ user.email }})</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                {% else %}
                    <div class="auth-links">
                        <a href="/login" class="btn-primary">–í–æ–π—Ç–∏</a>
                        <a href="/register" class="btn-secondary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    </div>
                {% endif %}
            </div>
        </header>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="nav">
            {% if current_user %}
                <a href="/create-post" class="btn-success">üìù –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</a>
            {% endif %}
            <a href="/api/users">üìä API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</a>
            <a href="/api/posts">üìÑ API –ø–æ—Å—Ç–æ–≤</a>
        </div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        {% if not has_users %}
        <div class="alert alert-warning">
            <h3>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>
            <p>–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–ª–æ–≥–æ–º, —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</p>
            <p><a href="/register" class="btn-primary">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a></p>
        </div>
        {% endif %}

        <!-- –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤ -->
        {% if not posts %}
            {% if has_users and current_user %}
                <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤. <a href="/create-post">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π!</a></p>
            {% elif has_users and not current_user %}
                <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤. <a href="/login">–í–æ–π–¥–∏—Ç–µ</a> —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç!</p>
            {% endif %}
        {% else %}
            <div class="posts-list">
                {% for post in posts %}
                    <div class="post">
                        <h3><a href="/post/{{ post.id }}">{{ post.title }}</a></h3>
                        <p class="post-meta">
                            <strong>–ê–≤—Ç–æ—Ä:</strong> {{ post.author_name }} | 
                            <strong>–î–∞—Ç–∞:</strong> {{ post.created_at }}
                        </p>
                        <p class="post-preview">{{ post.content_preview }}</p>
                        <div class="post-actions">
                            <a href="/post/{{ post.id }}">–ß–∏—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é</a>
                            {% if current_user and current_user.id == post.author_id %}
                            | <a href="/edit-post/{{ post.id }}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                            | <a href="/delete-post/{{ post.id }}" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?')">–£–¥–∞–ª–∏—Ç—å</a>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <script>
        function switchUser(userId) {
            if (userId) {
                window.location.href = '/switch-user/' + userId;
            }
        }
    </script>
</body>
</html>